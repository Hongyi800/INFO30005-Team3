<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <script src="mapdata.js"></script>
    <script src="InfoWin.js"></script>
    <title>World Map</title>
    <li>
        <a href="country-management">World status</a>
    </li>

</head>

<body>

    <script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.15&key=cc9b5116b54c2be17a209bf1b0fbacea"></script>
    <script type="text/javascript" src="https://webapi.amap.com/loca?v=1.3.2&key=cc9b5116b54c2be17a209bf1b0fbacea"></script>

<div id="map" class="container">
    <p style="width:1500px; height: 750px">This is a map container</p>
</div>

<script type="text/javascript">

    const mymap = new AMap.Map('map',{
        zoom: 4.5,
        center: [-100,40],
        lang:'en'

    })

    const mylayer = new Loca.PointLayer({
        map: mymap,
        eventSupport:true
    })

    mylayer.setData(mydata,{
        type: 'json',
        lnglat:function(obj){
            return [obj.value.attributes.Long_, obj.value.attributes.Lat]
        }
    })

    mylayer.setOptions({
        unit: 'px',
        style: {
            radius:(obj)=>{
                const num = obj.value.attributes.Confirmed;
                if(num >= 1000000) return 50;
                if(num>= 100000) return 50;
                if(num>= 70000) return 30;
                if(num>= 50000) return 30;
                if(num>= 30000) return 10;
                else return 10;
            },
            color:(obj)=>{
                const num = obj.value.attributes.Confirmed;
                if(num >= 1000000) return '#ff0000';
                if(num>= 100000) return '#ff0000';
                if(num>= 50000) return '#ff8800';
                if(num>= 40000) return '#ff8800';
                if(num>= 30000) return '#ffaa00';
                else return '#ffaa00';
            }
        },
        borderWidth: 0.5,
        borderColor: '#0000ff'
    })

    mylayer.render();

    //step5
    mylayer.on('click',function(ev){
        const rawData = ev.rawData;
        console.log(rawData);
        const originalEvent = ev.originalEvent;
        openInfoWin(mymap,originalEvent,{
            "Country Name":rawData.attributes.Combined_Key,
            "Confirmed Case":rawData.attributes.Confirmed,
            "Location":ev.lnglat
        })
    })

    //step6
    mymap.on('click',function(ev){
        closeInfoWin();
    })
</script>
</body>


</html>
