<!DOCTYPE html>
<html lang="en">
    <head>

        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
        <script src="mapdata2.js"></script>
        <script src="InfoWin.js"></script>
        <title>World Map</title>

    </head>
    <header>
        <div class="main">
            <ul>
                <li><a href="/">Home Page</a></li>
                <li><a href="login">Login Here</a></li>
                <li><a href="register">Register Here</a></li>
                <li><a href="comment">User Comment</a></li>
                <li><a href="information">News &amp; Information</a></li>
            </ul>
        </div>
    </header>

    <body>

        <script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.15&key=cc9b5116b54c2be17a209bf1b0fbacea"></script>
        <script type="text/javascript" src="https://webapi.amap.com/loca?v=1.3.2&key=cc9b5116b54c2be17a209bf1b0fbacea"></script>

        <h1>World Status and Epidemic Map</h1>
        <div class="grid-container">
            <div class="details">
                <h2>World Status</h2>
                <p>We provide epidemic data of all countries and regions in the world here.
                    If you want to visit, please click "World Status" below <br>
                </p>
                <ul class="status">
                    <li>
                        <a href="country-management">World status</a>
                    </li>
                </ul>
                <p> <br><br><br><br> </p>
                <h2>Epidemic Map</h2>
                <p>Here is the epidemic map for COVID-19 around the world.</p>
                <p>
                    We have provided data on all influenced countries with the severe coronavirus outbreaks in the world .
                    Additionally, we have marked the difference with colours for distinct levels of severity.
                    (e.g. total number of cumulative confirmed cases <40,000 will be marked as yellow,
                    >1,000,000 will be marked as red)
                </p>
                <p>
                    You can scroll the mouse to enlarge or reduce the map,
                    or you can drag the mouse and click the point on the country/city you would like to view
                </p>
            </div>

            <div id="map" class="container">
                <p style="width:1500px; height: 750px">This is a map container</p>
            </div>
        </div>

        <script type="text/javascript">

            const mymap = new AMap.Map('map',{
                zoom: 4.5,
                center: [-100,40],
                lang:'en'

            })

            const mylayer = new Loca.PointLayer({
                map: mymap,
                eventSupport:true
            })

            mylayer.setData(mydata,{
                type: 'json',
                lnglat:function(obj){
                    return [obj.value.longitude, obj.value.latitude]
                }
            })

            mylayer.setOptions({
                unit: 'px',
                style: {
                    radius:(obj)=>{
                        const num = obj.value.confirmed_cases;
                        if(num >= 1000000) return 30;
                        if(num>= 100000) return 30;
                        if(num>= 70000) return 20;
                        if(num>= 50000) return 20;
                        if(num>= 30000) return 10;
                        else return 10;
                    },
                    color:(obj)=>{
                        const num = obj.value.confirmed_cases;
                        if(num >= 1000000) return '#ff0000';
                        if(num>= 100000) return '#ff0000';
                        if(num>= 50000) return '#ff8800';
                        if(num>= 40000) return '#ff8800';
                        if(num>= 30000) return '#ffaa00';
                        else return '#ffaa00';
                    }
                },
                borderWidth: 0.5,
                borderColor: '#0000ff'
            })

            mylayer.render();

            //step5
            mylayer.on('click',function(ev){
                const rawData = ev.rawData;
                console.log(rawData);
                const originalEvent = ev.originalEvent;
                openInfoWin(mymap,originalEvent,{
                    "Country Name":rawData.country,
                    "Confirmed Case":rawData.confirmed_cases,
                    "Location":ev.lnglat
                })
            })

            //step6
            mymap.on('click',function(ev){
                closeInfoWin();
            })
        </script>

        <div id="footer">
            <p>Copyright &copy; 16/5/2020</p>
        </div>

    </body>

</html>
